s.registerPostTrackCallback(function(){
  s.clearVars();
});

s__useJquery = function(){return typeof $ !== 'undefined';},
 s__btExists = function(){return typeof bt !== 'undefined';},

/* Plugin Config */
s.usePlugins=true;
s.firstRun=true;
function s_doPlugins(s) {
if(s.firstRun===true){  
  
  // Setup config variables
    var s__products = (s__btExists() && typeof(bt.products) !== 'undefined')? bt.products:[],
        s__city = s__btExists() ? ((bt.city)? bt.city : 'No City') : 'No City';
    
    if (s__city.toLowerCase() !== 'national' && s__city.toLowerCase() !== 'no city') {
      s__city = s__city.split(', ');
      s__city = s__city[1] + '>' + s__city[0];
  
   
    s.tempPath=window.location.pathname.toLowerCase();

    // Login Status
    s.eVar11 = s__btExists() && typeof bt.authentication !== 'undefined' ? bt.authentication.loginstatus === 'logged in' : false; 
    
    // Set the initial channel value
    s.channel="Specials";
      
      
        // Set the Site Section Level 1 to the Channel > Site Section Level 1
      s.prop8=s.channel+">"+s.prop8;

      // Set the Page Name so that it starts with the Site Section Level 1 value
      s.pageName=s.prop8+(s.pageName?">"+s.pageName:"");

      // Set Site Section Level 2 to the value of the full page name
      s.prop9=s.pageName;
      
      // Add the City to the Page Name
      s.pageName += (s.prop8.indexOf('Listings')>-1? '>' + s__city : '');
      
      var newCategory="", category="";
      if(s.tempPath.indexOf("/category/")>-1 && s.tempPath.indexOf("/category/alldeals")==-1){
        category=s.tempPath.substring(s.tempPath.indexOf("/category/")+10);
      }
      if(category){
        category=category.replace(/\//g,":").replace(/\-/g," ").replace(/amp/gi," & ");
        for (var i=0;i<category.length;i++){
          if(i==0||(category.charAt(i-1)==":"||category.charAt(i-1)==" ")){
            newCategory+=category.charAt(i).toUpperCase();
          }else{
            newCategory+=category.charAt(i);
          }
        }
        s.pageName+=">"+newCategory;
      }
      if(s.prop10=="Listings"){
        if (typeof($) !== "undefined") {
          s.prop20 = s__products.length;
        }
        if(!s.prop20||s.prop20=="0"){
          s.pageName+=">No Deals";
          s.prop10="Listings-No Deals";
        }else if(!newCategory){
          s.pageName+=">All Deals";
        }
        
      }
  
/* Add calls to plugins here */
s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx";
s.linkInternalFilters="javascript:,mailto:,www.restaurant.com,www2.restaurant.com,mobile.restaurant.com,doubledeals.restaurant.com,specials.restaurant.com,thedish.restaurant.com,feedItforward.restaurant.com,ddcobrand.diningdough.com,theidealmeal.com,diningdough.com,gift.restaurant.com,giftcard.restaurant.com,about.restaurant.com,/m.restaurant.com,partners.restaurant.com,partnerblog.restaurant.com,sales.restaurant.com,help.restaurant.com,fundraiser.restaurant.com,coupons.restaurant.com," + document.location.hostname;
s.linkLeaveQueryString=false;
s.linkTrackVars="channel,prop1,prop2,prop16,eVar1,eVar2,eVar8,eVar10,eVar11,eVar13,eVar34,eVar35,eVar44,eVar45";
s.linkTrackEvents="None";
s.visitorNamespace="restaurantcom";
s.trackingServer="metrics.restaurant.com";
s.trackingServerSecure="smetrics.restaurant.com";
s.cjAffiliateLookup=window.gblCJList;
s.directAffiliateLookup=window.gblDirectList;
s.trackExternalLinks=true
s.linkDownloadFileTypes="exe,zip,wav,mp3,mov,mpg,avi,wmv,pdf,doc,docx,xls,xlsx,ppt,pptx";
s.linkInternalFilters="javascript:,mailto:,www.restaurant.com,www2.restaurant.com,mobile.restaurant.com,doubledeals.restaurant.com,specials.restaurant.com,thedish.restaurant.com,feedItforward.restaurant.com,ddcobrand.diningdough.com,theidealmeal.com,diningdough.com,gift.restaurant.com,giftcard.restaurant.com,about.restaurant.com,/m.restaurant.com,partners.restaurant.com,partnerblog.restaurant.com,sales.restaurant.com,help.restaurant.com,fundraiser.restaurant.com,coupons.restaurant.com," + document.location.hostname;
s.linkLeaveQueryString=false;
s.visitor = Visitor.getInstance("E550291B521E29CE0A490D4C@AdobeOrg");

  
  s.prop3=s.getPreviousValue(s.pageName,"c3","");
  if(!s.prop3||s.prop3==="no value"){
    s.prop3=s.prop7="Entry";
  }else{
    var ppva;
    try { ppva=s.getPercentPageViewed(s.pageName); } catch (ex) {s.c_w('s_ppv',0);}
      if(ppva&&ppva.length>2&&ppva[1]!="undefined"&&typeof(ppva[1])!="undefined"&&ppva[2]!="undefined"&&typeof(ppva[2])!="undefined"){
        s.prop7=ppva[1]+'|'+ppva[2];
      }else{
        s.prop7='No Data Available';
      }
  }
  s.eVar3="D=c3";

  s.eVar34="D=g"; 
  s.eVar35=(document.referrer||s.referrer)?"D=r":"Referrer Unknown";
  s.prop1=s.eVar1=(s.pageName)?"D=pageName":"";
  s.eVar8=(s.channel)?"D=ch":"";

		s.eVar45 = new Date().toJSON().slice(0,10);
  
  if (s.c_r('prti') || s.c_r('raid')) {
    s.eVar74 = (s.c_r('prti') || '99999') + '_' + (s.c_r('raid') || '100');
  }
      
    }
  
  s.useURL='';
  s__tempUseURL = document.location.href.toLowerCase();
  var s__qpLink = s.Util.getQueryParam("link",s__tempUseURL) || s.Util.getQueryParam("ip_link",s__tempUseURL);
  if(s__qpLink||s.Util.getQueryParam("u",s__tempUseURL)||s.Util.getQueryParam("prti",s__tempUseURL)||s.Util.getQueryParam("ext",s__tempUseURL)||((document.referrer||"").indexOf(document.location.hostname)==-1)){
    s.useURL=document.location.href;
  }else{
    s.useURL=document.referrer||"";
  }
  s.useURL=s.useURL.toLowerCase();

  if(s.Util.getQueryParam("prti",s.useURL)&&!s.Util.getQueryParam("ext",s.useURL)){
    s.tempPRTI=s.Util.getQueryParam("prti",s.useURL);
    s.tempAff=s.rdcAffiliateCheck(s.tempPRTI,s.cjAffiliateLookup);
    if(s.tempAff==="1"){
      s.tempPID=s.Util.getQueryParam("pid",s.useURL)?s.Util.getQueryParam("pid",s.useURL):"pid missing";
      s.tempAID=s.Util.getQueryParam("aid",s.useURL)?s.Util.getQueryParam("aid",s.useURL):"aid missing";
      s.eVar75="af_cj_"+s.tempPID+"_"+s.tempAID;
    }
    else{
      s.tempAff=s.rdcAffiliateCheck(s.tempPRTI,s.directAffiliateLookup);
      if(s.tempAff==="1"){
        s.tempRAID=s.Util.getQueryParam("raid",s.useURL);
        if(s.tempRAID){s.eVar75="af_direct_"+s.tempPRTI+"_"+s.tempRAID;}
        else{s.eVar75="af_direct_"+s.tempPRTI;}
      }
    }
  }
  s__qpLink = s.Util.getQueryParam("Link",s.useURL) || s.Util.getQueryParam("link",s.useURL) || s.Util.getQueryParam("ip_link", s.useURL);
  if(!s.eVar75) {
    if(s__qpLink){s.eVar75="em_"+s__qpLink;}
    else if(s.Util.getQueryParam("u",s.useURL)){s.eVar75="em_"+s.Util.getQueryParam("u",s.useURL);}
  }
  
  s_temprid = s.Util.getQueryParam("et_rid") || s.Util.getQueryParam("ip_rid");
  s_tempcid = s.Util.getQueryParam("et_cid") || s.Util.getQueryParam("ip_cid");
  s.eVar36=s.getValOnce(s_temprid,"v36");
  s.eVar37=s.getValOnce(s_tempcid,"v37");
  s.eVar33=s.getValOnce(s.Util.getQueryParam("sid,rbtid","|"),"v33");
  if(!s.eVar33){
    s.eVar33=s.getValOnce(s.Util.getQueryParam("augeotoken"),"v33");
  }
  s.eVar46=s.getValOnce(s.Util.getQueryParam("mkwid"),"v46");
  s.eVar48=s.getValOnce(s.Util.getQueryParam("trkid"),"v48");
  if(s.eVar75&&s.eVar75.indexOf('em_')>-1){
    s.eVar75+="_"+(s.Util.getQueryParam("et_cid",s.useURL)||s.Util.getQueryParam("j",s.useURL)||s.Util.getQueryParam("ip_cid", s.useURL)||"100")+"_"+(s.Util.getQueryParam("prti",s.useURL)||"100");
  }else if(!s.eVar75){
    s.eVar75=s.Util.getQueryParam('ext',s.useURL)||s.Util.getQueryParam('hbv',s.useURL)||s.Util.getQueryParam('mkwid',s.useURL)||s.Util.getQueryParam('trkid',s.useURL);
  }
  
  s.temp75=s.getValOnce(s.eVar75,"v75");
  if(s.temp75){
    s.events=s.apl(s.events,"event61",",",2);
  }

  if(!s.eVar26&&!s.eVar10&&s.eVar5){s.eVar26=s.eVar5;}
  
  s.eVar17="+1";
  s.prop16=s__codeVersion;
  if(s.products&&!s.events){s.products="";}
  if(!s.products && s.fakeProduct){
    s.products = ';' + s.fakeProduct + s.getProductNum();
  }
  
}
s.doPlugins=s_doPlugins

//time parting configuration
//Australia
s._tpDST = {
2012:'4/1,10/7',
2013:'4/7,10/6',
2014:'4/6,10/5',
2015:'4/5,10/4',
2016:'4/3,10/2',
2017:'4/2,10/1',
2018:'4/1,10/7',
2019:'4/7,10/6'}
 
//US
s._tpDST = {
2012:'3/11,11/4',
2013:'3/10,11/3',
2014:'3/9,11/2',
2015:'3/8,11/1',
2016:'3/13,11/6',
2017:'3/12,11/5',
2018:'3/11,11/4',
2019:'3/10,11/3'}
 
//Europe
s._tpDST = {
2012:'3/25,10/28',
2013:'3/31,10/27',
2014:'3/30,10/26',
2015:'3/29,10/25',
2016:'3/27,10/30',
2017:'3/26,10/29',
2018:'3/25,10/28',
2019:'3/31,10/27'}
/*plugins*/
/*
 * Plugin: getPreviousValue_v1.0 - return previous value of designated
 *   variable (requires split utility)
 */
s.getPreviousValue=new Function("v","c","el",""
+"var s=this,t=new Date,i,j,r='';t.setTime(t.getTime()+1800000);if(el"
+"){if(s.events){i=s.split(el,',');j=s.split(s.events,',');for(x in i"
+"){for(y in j){if(i[x]==j[y]){if(s.c_r(c)) r=s.c_r(c);v?s.c_w(c,v,t)"
+":s.c_w(c,'no value',t);return r}}}}}else{if(s.c_r(c)) r=s.c_r(c);v?"
+"s.c_w(c,v,t):s.c_w(c,'no value',t);return r}");
/*
 * Utility Function: split v1.5 - split a string (JS 1.0 compatible)
 */
s.split=new Function("l","d",""
+"var i,x=0,a=new Array;while(l){i=l.indexOf(d);i=i>-1?i:l.length;a[x"
+"++]=l.substring(0,i);l=l.substring(i+d.length);}return a");
	/*
* Plugin: getTimeParting 3.0 - Set timeparting values based on time zone - valid through 2014
*/
s.getTimeParting=new Function("t","z",""
+"var s=this,d,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T;d=new Date();A"
+"=d.getFullYear();if(A=='2009'){B='08';C='01'}if(A=='2010'){B='14';C"
+"='07'}if(A=='2011'){B='13';C='06'}if(A=='2012'){B='11';C='04'}if(A="
+"='2013'){B='10';C='03'}if(A=='2014'){B='09';C='02'}if(!B||!C){B='08"
+"';C='01'}B='03/'+B+'/'+A;C='11/'+C+'/'+A;D=new Date('1/1/2000');if("
+"D.getDay()!=6||D.getMonth()!=0){return'Data Not Available'}else{z=p"
+"arseFloat(z);E=new Date(B);F=new Date(C);G=F;H=new Date();if(H>E&&H"
+"<G){z=z+1}else{z=z};I=H.getTime()+(H.getTimezoneOffset()*60000);J=n"
+"ew Date(I+(3600000*z));K=['Sunday','Monday','Tuesday','Wednesday','"
+"Thursday','Friday','Saturday'];L=J.getHours();M=J.getMinutes();N=J."
+"getDay();O=K[N];P='AM';Q='Weekday';R='00';if(M>30){R='30'}if(L>=12)"
+"{P='PM';L=L-12};if(L==0){L=12};if(N==6||N==0){Q='Weekend'}T=L+':'+R"
+"+P;if(t=='h'){return T}if(t=='d'){return O}if(t=='w'){return Q}}");

/*
 * Plugin: getNewRepeat 1.2 - Returns whether user is new or repeat
 */
s.getNewRepeat=new Function("d","cn",""
+"var s=this,e=new Date(),cval,sval,ct=e.getTime();d=d?d:30;cn=cn?cn:"
+"'s_nr';e.setTime(ct+d*24*60*60*1000);cval=s.c_r(cn);if(cval.length="
+"=0){s.c_w(cn,ct+'-New',e);return'New';}sval=s.split(cval,'-');if(ct"
+"-sval[0]<30*60*1000&&sval[1]=='New'){s.c_w(cn,ct+'-New',e);return'N"
+"ew';}else{s.c_w(cn,ct+'-Repeat',e);return'Repeat';}");


/*
 * Plugin Utility: apl v1.1
 */
s.apl=new Function("l","v","d","u",""
+"var s=this,m=0;if(!l)l='';if(u){var i,n,a=s.split(l,d);for(i=0;i<a."
+"length;i++){n=a[i];m=m||(u==1?(n==v):(n.toLowerCase()==v.toLowerCas"
+"e()));}}if(!m)l=l?l+d+v:v;return l");

s.lowercaseVars=new Function("t",""
+"var s=this;if(s[t]&&t!='events'){s[t]=s[t].toString();if(s[t].index"
+"Of('D=')!=0){s[t]=s[t].toLowerCase();}}");

/*
* Utility s.gatherIntPromo v2.0 - Pass in query string value and
returns all instances of that value in a comma-delimited list
*/
s.gatherIntPromo=new Function("p","m","r",""
+"var s=this,a,d,e,i,l='',r=r?r:'';if(m=='0'){a=document.getElementsB"
+"yTagName('a');for(i=0;i<=a.length-1;i++){if(a[i].href.indexOf(p)!=-"
+"1){if(l==''){l=s.getURLVars(a[i].href)[p];}else{l=l+','+s.getURLVar"
+"s(a[i].href)[p];}}}}else if(m=='1'){a=document.getElementsByTagName"
+"('body')[0].innerHTML;e=a.match(r);if(e==null){return null;}else{d="
+"s.eliminateDuplicates(e);for(i=0;i<=d.length-1;i++){if(d[i].indexOf"
+"(p)!=-1){if(l==''){l=s.getURLVars(d[i])[p];}else{l=l+','+s.getURLVa"
+"rs(d[i])[p];}}}}}return l;");
s.eliminateDuplicates=new Function("ar",""
+"var s=this,j,le=ar.length,ou=[],ob={};for(j=0;j<le;j++){ob[ar[j]]=0"
+";}for(j in ob){ou.push(j);}return ou;");
s.getURLVars=new Function("u",""
+"var s=this,k,uv=[],uh,h=u.slice(u.indexOf('?')+1).split('&');for(k="
+"0;k<h.length;k++){uh=h[k].split('=');uv.push(uh[0]);uv[uh[0]]=uh[1]"
+";}return uv;");

/*
 * Plugin: getValOnce_v1.11
 */
s.getValOnce=new Function("v","c","e","t",""
+"var s=this,a=new Date,v=v?v:'',c=c?c:'s_gvo',e=e?e:0,i=t=='m'?6000"
+"0:86400000,k=s.c_r(c);if(v){a.setTime(a.getTime()+e*i);s.c_w(c,v,e"
+"==0?0:a);}return v==k?'':v");

/*
 * Copyright 2011-2013 Adobe Systems, Inc.
 * s_getLoadTime v1.36 - Get page load time in units of 1/10 seconds
 */
function s_getLoadTime(){if(!window.s_loadT){var b=new Date().getTime(),o=window.performance?performance.timing:0,a=o?o.requestStart:window.inHeadTS||0;s_loadT=a?Math.round((b-a)/100):''}return s_loadT}


/*
 *	getQueryParam v2.5 - H-code and AppMeasurement Compatible
 */ 
s.getQueryParam=function(p,d,u,h){var s=this,v="",i,j,t;d=d?d:"";u=u?u:s.pageURL?s.pageURL:s.wd?s.wd.location:window.location;while(p){i=p.indexOf(",");i=i<0?p.length:i;t=s.p_gpv(p.substring(0,i),u+"",h);if(t)t=t.indexOf("#")>-1?t.substring(0,t.indexOf("#")):t;if(t)v+=v?d+t:t;p=p.substring(i==p.length?i:i+1)}return v};
s.p_gpv=function(k,u,h){var s=this,v="",q;j=h==1?"#":"?";i=u.indexOf(j);if(k&&i>-1){q=u.substring(i+1);v=s.pt(q,"&","p_gvf",k)}return v};
s.p_gvf=function(t,k){if(t){var s=this,i=t.indexOf("="),p=i<0?t:t.substring(0,i),v=i<0?true:t.substring(i+1);if(p.toLowerCase()==k.toLowerCase())return s.epa?s.epa(v):s.unescape(v)}return""};

/*
 *	pt - utility function
 */ 
s.pt=function(x,d,f,a){var s=this,t=x,z=0,y,r;while(t){y=t.indexOf(d);y=y<0?t.length:y;t=t.substring(0,y);r=s[f](t,a);if(r)return r;z+=y+d.length;t=x.substring(z,x.length);t=z<x.length?t:""}return""};

/*
 * Function - read combined cookies v 0.36
 */
if(!s.__ccucr){s.c_rr=s.c_r;s.__ccucr=true;s.c_r=new Function("k","var s=this,d=new Date,v=s.c_rr(k),c=s.c_rr('s_pers'),i,m,e;if(v)return v;k=encodeURI(k);i=c.indexOf(' '+k+'=');c=i<0?s.c_rr('s_sess'):c;i=c.indexOf(' '+k+'=');m=i<0?i:c.indexOf('|',i);e=i<0?i:c.indexOf(';',i);m=m>0?m:e;v=i<0?'':decodeURI(c.substring(i+2+k.length,m<0?c.length:m));if(m>0&&m!=e)if(parseInt(c.substring(m+1,e<0?c.length:e))<d.getTime()){d.setTime(d.getTime()-60000);s.c_w(decodeURI(k),'',d);v='';}return v;");}

/*
 * Function - write combined cookies v 0.36
 */
if(!s.__ccucw){s.c_wr=s.c_w;s.__ccucw=true;s.c_w=new Function("k","v","e","this.new2=true;var s=this,d=new Date,ht=0,pn='s_pers',sn='s_sess',pc=0,sc=0,pv,sv,c,i,t;d.setTime(d.getTime()-60000);if(s.c_rr(k)) s.c_wr(k,'',d);k=encodeURI(k);pv=s.c_rr(pn);i=pv.indexOf(' '+k+'=');if(i>-1){pv=pv.substring(0,i)+pv.substring(pv.indexOf(';',i)+1);pc=1;}sv=s.c_rr(sn);i=sv.indexOf(' '+k+'=');if(i>-1){sv=sv.substring(0,i)+sv.substring(sv.indexOf(';',i)+1);sc=1;}d=new Date;if(e){if(e.getTime()>d.getTime()){pv+=' '+k+'='+encodeURI(v)+'|'+e.getTime()+';';pc=1;}}else{sv+=' '+k+'='+encodeURI(v)+';';sc=1;}if(sc) s.c_wr(sn,sv,0);if(pc){t=pv;while(t&&t.indexOf(';')!=-1){var t1=parseInt(t.substring(t.indexOf('|')+1,t.indexOf(';')));t=t.substring(t.indexOf(';')+1);ht=ht<t1?t1:ht;}d.setTime(ht);s.c_wr(pn,pv,d);}return v==s.c_r(decodeURI(k));");}

/*
 * Plugin: rdcDateStamp v1.0
 */
s.rdcDateStamp=new Function(""
+"var a=new Date();a.setTime(a-(6*60*60*1000));return a.getUTCFullYea"
+"r()+'-'+s.padDate(a.getUTCMonth()+1)+'-'+s.padDate(a.getUTCDate());"
);
s.padDate=new Function("n",""
+"return n<10?'0'+n:n;");

/*
 * Helper Function: rdcSocialTrack v1.0
 */
s.rdcSocialTrack=function(a){
  if(a){
    s.origLTV=s.linkTrackVars;
    s.eVar18=a;
    s.events=s.linkTrackEvents='event18';
    s.linkTrackVars=s.apl(s.linkTrackVars,'eVar18',',',2);
    s.linkTrackVars=s.apl(s.linkTrackVars,'events',',',2);
    s.linkTrackVars=s.apl(s.linkTrackVars,'prop17',',',2);
    s.tl(true,'o','Social Interaction');
    s.linkTrackVars=s.origLTV;
    s.linkTrackEvents='None';
  }
  else{
    return ''
  }
}

/*
 * Helper Function: rdcCleanArray v1.0 - Remove values from delimited string
 */
s.rdcCleanArray=function(st,v,d){
  if(!st||!v||!d){return "";}
  var i,oa,na=[];
  oa=st.split(d);
  for(i=0;i<oa.length;i++){
    if(oa[i]!==v){na.push(oa[i]);}
  }
  return na.join(d);
}

/*
 * Helper Function: rdcAffiliateCheck v1.0
 */
s.rdcAffiliateCheck=function(a,b){
  if(a&&b){
    var i,p=parseInt(a),v;
    for(i=0;i<b.length;i++){
      if(b[i]===p){v=true;break;}
    }
    if(v===true){return '1';}
    else{return '0';}
  }
  else{return '';}
}

/*
 * Helper Function: Gift This tracking
 */
s.rdcGiftThis = function() {
  var tmpv11=s.eVar11,
      tmpch=s.channel;
  s.clearVars();
  s.eVar11=tmpv11;
  s.channel=tmpch;
  s.pageName = "Specials>Checkout>Send A Gift";
  s.prop8 = "Specials>Checkout";
  s.prop9 = "D=c8";
  s.prop10 = "Cart-Checkout";
  s.t();
}

/*
 * Helper Function: getProductNum - for setting 'fake' products on merchandise binding events
 */
s.getProductNum = function() {
  var s = this, pn, e = new Date();
  if (!s.c_r('pn')) pn = 1;
  else pn = parseInt(s.c_r('pn')) + 1;
  e.setTime(e.getTime() + (30 * 86400000));
  s.c_w('pn', pn, e);
  
  return pn;
}
}
